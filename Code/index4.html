<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8" />

    <title>WebGL Ocean</title>
    <style>
      body {
        margin: 0;
        font-family: monospace;
      }
      canvas {
        display: block;
        width: 100vw;
        height: 100vh;
      }
      #b {
        position: absolute;
        top: 10px;
        width: 100%;
        text-align: center;
        z-index: 2;
      }
    </style>
  </head>
  <body>
    <canvas id="c"></canvas>
  </body>
  <script id="vs" type="notjs">
    #version 300 es
    uniform mat4 u_worldViewProjection;
   
    in vec4 position;
    
    void main() {
      vec4 v_position = u_worldViewProjection * position;
      gl_Position = v_position;
    }
      </script>
      <script id="fs" type="notjs">
    #version 300 es
    precision mediump float;
    out vec4 FragColor;   
    void main() {

      FragColor = vec4(1.0, 0.0, 0.0, 1.0);
    }
      </script>

  <script src="gl-matrix.js"></script>

  <script type="module">
    import * as twgl from "./twgl-full.module.js";
    const m4 = twgl.m4;
    const gl = document.querySelector("#c").getContext("webgl2");
    const programInfo = twgl.createProgramInfo(gl, ["vs", "fs"]);

    var mapSize = 256;
    var oceanGrid = []

    for (var i = 0; i < mapSize - 1; i++) {
        for (var j = 0; j < mapSize - 1; j++) {
          oceanGrid.push(j - mapSize/2);
          oceanGrid.push(0);
          oceanGrid.push(i - mapSize/2);
          
          oceanGrid.push(j - mapSize/2);
          oceanGrid.push(0);
          oceanGrid.push(i+1 - mapSize/2);

          oceanGrid.push(j+1 - mapSize/2);
          oceanGrid.push(0);
          oceanGrid.push(i - mapSize/2);

          oceanGrid.push(j+1 - mapSize/2);
          oceanGrid.push(0);
          oceanGrid.push(i - mapSize/2);

          oceanGrid.push(j - mapSize/2);
          oceanGrid.push(0);
          oceanGrid.push(i+1 - mapSize/2);

          oceanGrid.push(j+1 - mapSize/2);
          oceanGrid.push(0);
          oceanGrid.push(i+1 - mapSize/2);
        }
      }

    const arrays = {
      position: oceanGrid,
    };
    const bufferInfo = twgl.createBufferInfoFromArrays(gl, arrays);

    const uniforms = {
    };

    function render(time) {
      twgl.resizeCanvasToDisplaySize(gl.canvas);
      gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);

      gl.enable(gl.DEPTH_TEST);
      gl.enable(gl.CULL_FACE);
      gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

      const fov = 30 * Math.PI / 180;
      const aspect = gl.canvas.clientWidth / gl.canvas.clientHeight;
      const zNear = 1;
      const zFar = 1000;
      const projection = m4.perspective(fov, aspect, zNear, zFar);
      const eye = [100, 20, 100];
      const target = [0, 0, 0];
      const up = [0, 1, 0];

      const camera = m4.lookAt(eye, target, up);
      const view = m4.inverse(camera);
      const viewProjection = m4.multiply(projection, view);
      const world = m4.identity();

      uniforms.u_viewInverse = camera;
      uniforms.u_world = world;
      uniforms.u_worldInverseTranspose = m4.transpose(m4.inverse(world));
      uniforms.u_worldViewProjection = m4.multiply(viewProjection, world);

      gl.useProgram(programInfo.program);
      twgl.setBuffersAndAttributes(gl, programInfo, bufferInfo);
      twgl.setUniforms(programInfo, uniforms);
      //gl.drawElements(gl.TRIANGLES, bufferInfo.numElements, gl.UNSIGNED_SHORT, 0);
      twgl.drawBufferInfo(gl, bufferInfo);

      requestAnimationFrame(render);
    }
    requestAnimationFrame(render);
  </script>
</html>
